source /home/diegoa/dev/gridanalyzer/gridanalyzer_lib.tcl
###################################################################
# XYZ COORDINATES OF LISs 
###################################################################

# LIS A1
set xyz_REF_A1 { {27.924000 34.550999 33.185001} {26.924000 33.550999 32.185001} {26.924000 34.550999 32.185001} {26.924000 34.550999 33.185001} }
# LIS A2
set xyz_REF_A2 { { 22.924000 35.550999 31.184999 } { 23.924000 35.550999 31.184999 } { 23.995001 35.528000 31.538000 } }
# LIS A3
set xyz_REF_A3 { { 18.924000 38.550999 33.185001 } { 18.995001 38.528000 33.537998 } { 19.924000 38.550999 32.185001 } { 19.924000 40.550999 33.185001 } { 18.924000 38.550999 32.185001 } { 19.924000 40.550999 33.185001 } { 19.924000 41.550999 32.185001 } { 20.924000 41.550999 31.184999 } { 18.924000 41.550999 33.185001 } { 18.924000 42.550999 32.185001 } { 18.924000 42.550999 33.185001 } { 17.924000 42.550999 33.185001 } { 17.924000 43.550999 32.185001 } { 17.995001 43.528000 32.537998 } { 17.924000 43.550999 33.185001 } { 18.924000 43.550999 31.184999 } { 19.924000 46.550999 35.185001 } }
# LIS B1
set xyz_REF_B1 { { 28.924000 28.551001 32.185001 } { 26.924000 28.551001 30.184999 } { 27.924000 29.551001 32.185001 } { 26.924000 29.551001 31.184999 } { 26.924000 29.551001 32.185001 } { 26.995001 29.528000 32.537998 } { 27.924000 31.551001 32.185001 } }
# LIS B2
set xyz_REF_B2 { { 29.924000 24.551001 30.184999 } { 29.995001 24.528000 30.538000 } }
# LIS B8
set xyz_REF_B8 { { 27.924000 30.551001 28.184999 } { 27.995001 30.528000 28.538000 } { 27.924000 30.551001 29.184999 } { 26.924000 30.551001 29.184999 } { 29.924000 28.551001 28.184999 } { 28.924000 29.551001 29.184999 } { 28.995001 28.528000 28.538000 } }
# LIS B9
set xyz_REF_B9 { { 32.924000 34.550999 24.184999 } { 32.924000 34.550999 23.184999 } { 32.924000 33.550999 23.184999 } { 35.924000 35.550999 24.184999 } { 35.994999 34.528000 23.538000 } { 35.924000 34.550999 23.184999 } { 33.924000 34.550999 24.184999 } { 33.994999 34.528000 23.538000 } { 33.924000 34.550999 23.184999 } { 35.924000 37.550999 25.184999 } { 35.924000 36.550999 25.184999 } { 35.924000 37.550999 24.184999 } { 35.924000 36.550999 24.184999 } { 36.924000 37.550999 24.184999 } }
# LIS B10
set xyz_REF_B10 { { 26.924000 35.550999 23.184999 } { 26.995001 36.528000 23.538000 } { 26.924000 36.550999 23.184999 } }
# LIS B6
set xyz_REF_B6 { { 34.994999 25.528000 33.537998 } { 34.924000 24.551001 34.185001 } { 33.924000 23.551001 34.185001 } { 34.924000 26.551001 32.185001 } { 34.924000 25.551001 32.185001 } { 34.924000 25.551001 33.185001 } { 34.924000 26.551001 31.184999 } }
# LIS B7
set xyz_REF_B7 { { 38.924000 26.551001 34.185001 } { 38.994999 26.528000 33.537998 } { 38.924000 26.551001 33.185001 } { 37.924000 26.551001 33.185001 } { 39.924000 25.551001 34.185001 } { 38.924000 25.551001 34.185001 } { 37.994999 25.528000 35.537998 } { 37.924000 25.551001 35.185001 } { 39.924000 26.551001 35.185001 } { 39.924000 25.551001 36.185001 } { 38.924000 25.551001 36.185001 } { 37.924000 25.551001 36.185001 } { 37.924000 26.551001 38.185001 } { 37.924000 26.551001 37.185001 } { 37.994999 26.528000 37.537998 } { 38.924000 26.551001 37.185001 } { 39.924000 27.551001 38.185001 } { 38.924000 27.551001 38.185001 } { 38.924000 27.551001 37.185001 } { 37.924000 27.551001 38.185001 } }
# LIS B3
set xyz_REF_B3 { { 28.924000 18.551001 28.184999 } { 28.995001 18.528000 28.538000 } { 28.924000 18.551001 29.184999 } { 28.924000 19.551001 30.184999 } { 28.924000 17.551001 28.184999 } }
# LIS B5
set xyz_REF_B5 { { 21.924000 15.551000 32.185001 } { 21.995001 16.528000 32.537998 } { 21.924000 16.551001 32.185001 } { 20.924000 15.551000 32.185001 } { 21.924000 14.551000 32.185001 } { 21.995001 14.528000 31.538000 } { 21.924000 15.551000 31.184999 } { 24.924000 15.551000 30.184999 } { 23.924000 15.551000 30.184999 } { 23.924000 14.551000 30.184999 } { 23.924000 14.551000 31.184999 } { 22.924000 14.551000 31.184999 } }
# LIS B4
set xyz_REF_B4 { { 31.995001 15.528000 23.538000 } { 31.924000 15.551000 25.184999 } { 31.995001 15.528000 25.538000 } { 32.924000 14.551000 23.184999 } { 31.924000 14.551000 23.184999 } { 32.924000 15.551000 23.184999 } { 31.924000 14.551000 22.184999 } { 34.924000 14.551000 24.184999 } { 33.924000 14.551000 23.184999 } { 33.924000 15.551000 23.184999 } { 34.924000 13.551000 25.184999 } { 35.924000 14.551000 25.184999 } { 34.924000 14.551000 25.184999 } { 34.994999 14.528000 24.538000 } { 35.924000 15.551000 25.184999 } { 35.924000 15.551000 23.184999 } { 35.924000 15.551000 24.184999 } { 34.924000 15.551000 24.184999 } { 34.924000 15.551000 23.184999 } { 35.924000 16.551001 23.184999 } { 34.924000 16.551001 23.184999 } { 33.924000 16.551001 23.184999 } { 35.924000 13.551000 24.184999 } { 34.924000 12.551000 26.184999 } { 33.924000 12.551000 25.184999 } { 34.994999 12.528000 25.538000 } { 34.924000 12.551000 25.184999 } }
# LIS C1
set xyz_REF_C1 { { 29.924000 37.550999 36.185001 } { 30.995001 36.528000 35.537998 } { 30.924000 36.550999 36.185001 } { 28.924000 36.550999 36.185001 } { 28.995001 36.528000 36.537998 } { 28.924000 37.550999 36.185001 } { 29.924000 37.550999 35.185001 } { 29.924000 35.550999 36.185001 } }
# LIS C4/5
set xyz_REF_C4 { { 28.924000 32.550999 38.185001 } { 27.924000 32.550999 38.185001 } { 27.924000 33.550999 38.185001 } { 28.924000 33.550999 38.185001 } { 28.924000 34.550999 38.185001 } { 30.924000 32.550999 38.185001 } { 29.924000 32.550999 38.185001 } { 29.995001 32.528000 38.537998 } { 29.924000 32.550999 39.185001 } { 30.995001 34.528000 38.537998 } { 30.924000 34.550999 39.185001 } { 31.924000 33.550999 39.185001 } }
# LIS C2
set xyz_REF_C2 { { 31.924000 38.550999 36.185001 } { 31.924000 39.550999 37.185001 } { 31.924000 39.550999 36.185001 } { 31.924000 38.550999 36.185001 } { 32.924000 40.550999 36.185001 } { 31.924000 40.550999 37.185001 } { 31.995001 40.528000 36.537998 } { 31.924000 40.550999 36.185001 } { 30.924000 40.550999 36.185001 } { 33.924000 42.550999 35.185001 } { 32.924000 42.550999 36.185001 } { 30.924000 41.550999 37.185001 } { 31.924000 41.550999 36.185001 } { 30.924000 41.550999 36.185001 } { 33.994999 40.528000 38.537998 } { 33.924000 40.550999 38.185001 } { 33.924000 40.550999 37.185001 } { 33.924000 40.550999 36.185001 } { 31.924000 41.550999 39.185001 } { 31.924000 40.550999 39.185001 } }
# LIS C3
set xyz_REF_C3 { { 34.924000 43.550999 40.185001 } { 34.924000 42.550999 41.185001 } { 34.994999 42.528000 40.537998 } { 36.994999 43.528000 39.537998 } { 36.924000 43.550999 39.185001 } { 37.924000 42.550999 40.185001 } { 37.924000 44.550999 40.185001 } { 36.924000 44.550999 40.185001 } }


#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
#  VARIABLES DEFINITION
#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

# Load TCL packages math::statistics
set auto_path "$auto_path /usr/share/tcltk/tcl8.6 /usr/share/tcltk /usr/lib /usr/local/lib/tcltk /usr/local/share/tcltk /usr/lib/tcltk/x86_64-linux-gnu /usr/lib/tcltk /usr/lib/tcltk/tcl8.6"
package require math
package require math::statistics
source /home/diegoa/dev/gridanalyzer/gridanalyzer_lib.tcl


proc LMP_search_bootstrap { xyz_REF_ini xyz_REF_end label1 label2 LMP_filename rsmp_n } {
   puts "Variable xyz_REF_ini: $xyz_REF_ini"
   for {set rsmp 1} {$rsmp < $rsmp_n} {incr rsmp} {
      # Load pdb file containing resample number $rsmp
      set molID [mol new "resamp_2217_opt_${rsmp}.pdb" type pdb]
   
      # From the refference LIS positions determine which are really present in
      # current resample, as a list of indexes.
      set start_indx [ LIS_exists $molID $xyz_REF_ini 0.5 ]
      set end_indx [ LIS_exists $molID $xyz_REF_end 0.5 ]
   
      # Read DX file grid to analyze.
      read_DX "resamp_2217_${rsmp}.dx"
   
      foreach s $start_indx {
      foreach f $end_indx {
         # Search for pathways starting at index $s and ending in indec $f.
         search_pathways2 $s $f $molID $LMP_filename
      }}
   
   
      # Clean house
      mol delete $molID
   }
}

set label_pair_list [ list {A1 A2} {A2 A3} {A1 C1} {C1 C2} {C2 C3} {C1 C4} {A1 B1} {B1 B2} {B2 B3} {B3 B4} {B3 B5} {B2 B6} {B2 B7} {B1 B8} {B8 B9} {B8 B10} ]
set xyz_pair_list {}
lappend xyz_pair_list \
        [list $xyz_REF_A1 $xyz_REF_A2] \
        [list $xyz_REF_A2 $xyz_REF_A3] \
        [list $xyz_REF_A1 $xyz_REF_C1] \
        [list $xyz_REF_C1 $xyz_REF_C2] \
	[list $xyz_REF_C2 $xyz_REF_C3] \
	[list $xyz_REF_C1 $xyz_REF_C4] \
	[list $xyz_REF_A1 $xyz_REF_B1] \
	[list $xyz_REF_B1 $xyz_REF_B2] \
	[list $xyz_REF_B2 $xyz_REF_B3] \
	[list $xyz_REF_B3 $xyz_REF_B4] \
	[list $xyz_REF_B3 $xyz_REF_B5] \
	[list $xyz_REF_B2 $xyz_REF_B6] \
	[list $xyz_REF_B2 $xyz_REF_B7] \
	[list $xyz_REF_B1 $xyz_REF_B8] \
	[list $xyz_REF_B8 $xyz_REF_B9] \
	[list $xyz_REF_B8 $xyz_REF_B10] 

set n_LMPs [ llength $label_pair_list ]
set rsmp_n 1153
set cutoff 0.5
set pathways_filename "LMP_tmp.pdb"


# Loop over initial/final LIS pairs. Resample instances are looped inside LMP_search_bootstrap proc.
for {set i 0} {$i < $n_LMPs} {incr i} {
   # Remove previous runs outputs.
   exec rm -f "network.dat"
   exec rm -f $pathways_filename
   exec rm -f "pathway_tmp.ene"

   # Set initial and final coordinates and labels for LMP.
   set ini_xyz_ref [ lindex $xyz_pair_list $i 0 ]
   set end_xyz_ref [ lindex $xyz_pair_list $i 1 ]
   set ini_label [ lindex $label_pair_list $i 0 ]
   set end_label [ lindex $label_pair_list $i 1 ]

   # RUN LMP SEARCH.
   LMP_search_bootstrap $ini_xyz_ref $end_xyz_ref $ini_label $end_label $pathways_filename $rsmp_n

   # Rename temp files with correct labels.
   exec mv network.dat network_${ini_label}-${end_label}.dat
   exec mv $pathways_filename LMP_${ini_label}-${end_label}.pdb
   exec mv pathway_tmp.ene LMP_${ini_label}-${end_label}.ene
   exec mv pathway_tmp2.ene LMP_${ini_label}-${end_label}_alt.ene

   # Clean global variables.
   unset grilla
   unset valList
   unset endgridX
   unset endgridY
   unset endgridZ
   unset xdelta
   unset ydelta
   unset zdelta
   unset xOrigen
   unset yOrigen
   unset zOrigen
}


quit


